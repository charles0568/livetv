"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[482],{2999:function(le,L,n){n.d(L,{p:function(){return o},v:function(){return y}});var N=n(88767),c=n(85893),o=new N.QueryClient({defaultOptions:{queries:{staleTime:30*1e3,refetchInterval:!1,refetchIntervalInBackground:!1,refetchOnWindowFocus:!1}}}),y=function(b){var m=b.children;return(0,c.jsx)(N.QueryClientProvider,{client:o,children:m})}},82250:function(le,L,n){n.d(L,{h:function(){return m}});var N=n(5574),c=n.n(N),o=n(64599),y=n.n(o),S=n(30937),b=n(82188),m=new S.YD({timeout:1e4,baseURL:"/api",withCredentials:!0});m.interceptors.request.use(function(t){if(t.headers["Content-Type"]==="multipart/form-data"){var U=new FormData;for(var j in t.data)t.data[j]!==void 0&&t.data[j]!==null&&U.append(j,t.data[j]);t.data=U}if(t.headers["Content-Type"]==="application/x-www-form-urlencoded"){var C=new URLSearchParams;for(var P in t.data)t.data[P]!==void 0&&t.data[P]!==null&&C.set(P,t.data[P]);t.data=C}return t},function(t){console.log(t),Promise.reject(t)}),m.interceptors.response.use(function(t){switch(t.status){case 200:break;case 401:b.m8.replace("/login");default:return Promise.reject(t)}return t},function(t){return t.response?console.error("API Error:",t.response.data):t.request?console.error("Network Error:",t.request):console.error("Error:",t.message),Promise.reject(t)});function k(t){if(!t)return[];var U=t.split(";"),j=[],C=_createForOfIteratorHelper(U),P;try{for(C.s();!(P=C.n()).done;){var H=P.value,Y=H.trim().split("="),J=_slicedToArray(Y,2),_=J[0],q=J[1];j.push({key:_,value:q})}}catch(ee){C.e(ee)}finally{C.f()}return j}},120:function(le,L,n){n.r(L),n.d(L,{default:function(){return Se}});var N=n(5574),c=n.n(N),o=n(67294),y={container:"container___bXV7B",title:"title___TH1Ur",liveUrl:"liveUrl___E7uD9",m3u8:"m3u8____5PD_",playlist:"playlist___S8c1D",toolbar:"toolbar___JnoNk"},S=n(78957),b=n(5529),m=n(68872),k=n(72003),t=n(71114),U=n(14726),j=n(72035),C=n(82911),P=n(89739),H=n(10844),Y=n(4340),J=n(63606),_=n(2099),q=n(60532),ee=n(86548),de=n(48689),ce=n(42952),he=n(57132),fe=n(93967),ve=n.n(fe),me=n(97857),G=n.n(me),p=n(82250),u=n(27494),ne=n(66184),xe=n(84567),g=n(88767),ye={TsProxySelector:"TsProxySelector___q636z"},e=n(85893);function je(a){var v=u.Z.useForm(),f=c()(v,1),s=f[0],w=(0,o.useState)(!1),A=c()(w,2),R=A[0],I=A[1],Q=(0,o.useState)(!1),O=c()(Q,2),F=O[0],E=O[1],D=ne.Z.Option,T=(0,o.useRef)(null),B=(0,o.useState)(""),V=c()(B,2),M=V[0],Z=V[1],$=(0,g.useQuery)("parsers",function(){return p.h.get("/plugins").then(function(h){return JSON.parse(h.data).map(function(r){return{label:r,value:r}})})}),K=$.data;function z(){s==null||s.validateFields().then(function(h){I(!0),a.onAdd(G()(G()({},h),{},{Proxy:h.Proxy&&h.Proxy!=="0",TsProxy:h.Proxy==="2"?M:"",ProxyUrl:h.UseProxy?h.ProxyUrl:""})).finally(function(){I(!1)})})}(0,o.useEffect)(function(){a.visible&&(E(!1),s==null||s.resetFields(),s==null||s.setFieldValue("Parser","youtube"),a.mode==="edit"&&(s==null||s.setFieldsValue(G()(G()({},a.channel),{},{Proxy:a.channel.Proxy?a.channel.TsProxy?"2":"1":"0",UseProxy:!!a.channel.ProxyUrl})),E(!!a.channel.ProxyUrl),Z(a.channel.TsProxy)))},[a.visible]);function W(h,r){var x=r.UseProxy;E(!!x)}return(0,e.jsx)(k.Z,{open:a.visible,onCancel:a.onCancel,onOk:z,destroyOnClose:!0,maskClosable:!1,confirmLoading:R,title:a.mode==="add"?"New Channel":"Edit Channel",children:(0,e.jsx)("div",{style:{marginTop:20},children:(0,e.jsxs)(u.Z,{labelCol:{span:6},form:s,onValuesChange:W,children:[(0,e.jsx)(u.Z.Item,{name:"ID",hidden:!0}),(0,e.jsx)(u.Z.Item,{label:"Channel Name",name:"Name",rules:[{required:!0}],children:(0,e.jsx)(t.Z,{placeholder:"Channel name",allowClear:!0})}),(0,e.jsx)(u.Z.Item,{label:"Live URL",name:"URL",rules:[{required:!0}],children:(0,e.jsx)(t.Z,{placeholder:"URL",allowClear:!0})}),(0,e.jsx)(u.Z.Item,{label:"Parser",name:"Parser",rules:[{required:!0}],children:(0,e.jsx)(ne.Z,{placeholder:"URL",options:K})}),(0,e.jsx)(u.Z.Item,{label:"Proxy stream",name:"Proxy",children:(0,e.jsxs)(ne.Z,{optionLabelProp:"title",defaultValue:"0",children:[(0,e.jsx)(D,{value:"0",title:"No proxy",children:"No proxy"}),(0,e.jsx)(D,{value:"1",title:"Same as baseurl",children:"Same as baseurl"}),(0,e.jsx)(D,{value:"2",title:"Custom: "+M,children:(0,e.jsxs)("div",{className:ye.TsProxySelector,children:[(0,e.jsx)("span",{children:"Custom:"}),(0,e.jsx)(t.Z,{ref:T,onClick:function(r){var x;r.stopPropagation(),(x=T.current)===null||x===void 0||x.focus()},onDoubleClick:function(){var r;(r=T.current)===null||r===void 0||r.select()},placeholder:"https://example.com",value:M,onChange:function(r){return Z(r.target.value)}})]})})]})}),(0,e.jsx)(u.Z.Item,{label:"Use Proxy",name:"UseProxy",valuePropName:"checked",children:(0,e.jsx)(xe.Z,{})}),(0,e.jsx)(u.Z.Item,{label:"Proxy string",name:"ProxyUrl",hidden:!F,children:(0,e.jsx)(t.Z,{placeholder:"socks5://user:password@example.com:443"})})]})})})}var X=n(2999),Ce=n(75214),Pe=n(82188),pe=n(73711),ge=n(64576);function Ze(a){var v=u.Z.useForm(),f=c()(v,1),s=f[0],w=u.Z.useForm(),A=c()(w,1),R=A[0],I=(0,o.useState)("config"),Q=c()(I,2),O=Q[0],F=Q[1];function E(){s.setFieldValue("baseurl",window.location.origin)}function D(){var r=Math.random().toString(36).substring(2);s.setFieldValue("secret",r)}var T=function(){return(0,e.jsxs)(u.Z,{labelCol:{span:6},form:s,children:[(0,e.jsx)(u.Z.Item,{name:"cmd",label:"yt-dlp Cmd",rules:[{required:!0}],children:(0,e.jsx)(t.Z,{placeholder:"yt-dlp"})}),(0,e.jsx)(u.Z.Item,{name:"args",label:"yt-dlp Args",rules:[{required:!0}],children:(0,e.jsx)(t.Z,{placeholder:"--extractor-args youtube:skip=dash -f b -g {url}"})}),(0,e.jsx)(u.Z.Item,{name:"baseurl",label:"BaseUrl",rules:[{required:!0}],children:(0,e.jsx)(t.Z,{placeholder:window.location.origin,suffix:(0,e.jsx)(b.Z,{title:"Autofill with current site",children:(0,e.jsx)(pe.Z,{onClick:E})})})}),(0,e.jsx)(u.Z.Item,{name:"secret",label:"Server secret",children:(0,e.jsx)(t.Z,{suffix:(0,e.jsx)(b.Z,{title:"Randomize",children:(0,e.jsx)(ge.Z,{onClick:D})})})}),(0,e.jsx)(u.Z.Item,{name:"apikey",label:"Data API",children:(0,e.jsx)(t.Z,{})})]})},B=function(){return(0,e.jsxs)(u.Z,{labelCol:{span:7},form:R,children:[(0,e.jsx)(u.Z.Item,{name:"password",label:"New Password",rules:[{required:!0,message:"Input your password"}],children:(0,e.jsx)(t.Z,{type:"password"})}),(0,e.jsx)(u.Z.Item,{name:"password2",label:"Repeat Password",rules:[{required:!0,message:"Repeat your password"}],children:(0,e.jsx)(t.Z,{type:"password"})})]})},V=function(){return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{children:["Based on ",(0,e.jsx)("a",{href:"https://github.com/zjyl1994/livetv",children:"LiveTV!"})," by ",(0,e.jsx)("a",{href:"https://github.com/zjyl1994",children:"zjyl1994."})]}),(0,e.jsxs)("div",{children:["Forked by ",(0,e.jsx)("a",{href:"https://github.com/snowie2000",children:"snowie2000"})]}),(0,e.jsxs)("div",{children:["Made with ",(0,e.jsx)("span",{style:{color:"#e25555"},children:"\u2665"})," in Kwangtung."]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("a",{href:"/log",target:"_blank",children:"View log"}),"\xA0\xA0\xA0|\xA0\xA0\xA0",(0,e.jsx)("a",{onClick:function(){return z.mutate()},children:"Log out"})]})]})},M=(0,g.useQuery)("live-config",function(){return p.h.get("/getconfig").then(function(r){return JSON.parse(r.data)})},{enabled:a.visible}),Z=M.data;(0,o.useEffect)(function(){a.visible&&Z&&s.setFieldsValue(Z)},[Z,a.visible]),(0,o.useEffect)(function(){a.visible&&F("config")},[a.visible]);var $=(0,g.useMutation)(function(r){return p.h.post("/updconfig",r,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){X.p.invalidateQueries("live-config")}}),K=(0,g.useMutation)(function(r){return p.h.post("/changepwd",r,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}),z=(0,g.useMutation)(function(){return p.h.get("/logout")},{onSuccess:function(){function x(ae){document.cookie="".concat(ae,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/")}x("mysession"),Pe.m8.replace("/login")}});function W(){switch(O){case"config":{s.validateFields().then($.mutateAsync).then(function(){return a.onClose()});break}case"password":{R.validateFields().then(function(r){return r.password!==r.password2?(m.ZP.warning("Passwords do not match"),Promise.reject()):K.mutateAsync(r)}).then(function(){z.mutate(),a.onClose()});break}case"about":{a.onClose();break}}}var h=[{label:"Config",key:"config",children:(0,e.jsx)(T,{})},{label:"Password",key:"password",children:(0,e.jsx)(B,{})},{label:"About",key:"about",children:(0,e.jsx)(V,{})}];return(0,e.jsx)(k.Z,{title:"Options",open:a.visible,onCancel:a.onClose,onOk:W,destroyOnClose:!0,children:(0,e.jsx)(Ce.Z,{items:h,defaultActiveKey:"config",activeKey:O,onChange:F})})}var te=[{title:"#",width:60,dataIndex:"No"},{title:"Name",width:150,dataIndex:"Name"},{title:"Live",dataIndex:"URL",render:function(v){return(0,e.jsx)("span",{className:y.liveUrl,children:v})}},{title:"M3U8",dataIndex:"M3U8",render:function(v,f,s){var w=[(0,e.jsx)(C.Z,{style:{color:"#CCC"}}),(0,e.jsx)(P.Z,{style:{color:"#52c41a"}}),(0,e.jsx)(H.Z,{style:{color:"#faad14"}}),(0,e.jsx)(Y.Z,{style:{color:"#ff4d4f"}}),(0,e.jsx)(H.Z,{style:{color:"#faad14"}})];return(0,e.jsxs)(S.Z,{children:[(0,e.jsx)(b.Z,{title:(0,e.jsxs)(e.Fragment,{children:[f.Message,(0,e.jsx)("br",{}),f.LastUpdate]}),children:w[f.Status]}),(0,e.jsx)("span",{className:y.m3u8,children:v})]})}},{title:"Proxy",width:80,render:function(v,f){return(0,e.jsxs)(S.Z,{children:[f.Proxy&&(0,e.jsx)(J.Z,{title:"Stream proxied"}),!!f.ProxyUrl&&(0,e.jsx)(_.Z,{title:"Connect via proxy"})]})}},{title:(0,e.jsx)(q.Z,{}),width:80}];function se(a){return{id:a.ID,url:a.URL,name:a.Name,proxy:a.Proxy,parser:a.Parser,proxyurl:a.ProxyUrl,tsproxy:a.TsProxy}}function Se(){var a=(0,o.useState)(!1),v=c()(a,2),f=v[0],s=v[1],w=(0,o.useState)(!1),A=c()(w,2),R=A[0],I=A[1],Q=(0,o.useState)("add"),O=c()(Q,2),F=O[0],E=O[1],D=(0,o.useState)(""),T=c()(D,2),B=T[0],V=T[1],M=(0,o.useState)(!1),Z=c()(M,2),$=Z[0],K=Z[1],z=(0,o.useState)(),W=c()(z,2),h=W[0],r=W[1];(0,o.useEffect)(function(){document.title="Channel List - LiveTV!"},[]);var x=(0,g.useMutation)(function(l){return p.h.post("/newchannel",se(l),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){X.p.invalidateQueries("channelList")},onError:function(i){var d;m.ZP.error((d=i==null?void 0:i.data)!==null&&d!==void 0?d:"Unknown error")}}),ae=(0,g.useMutation)(function(l){return p.h.get("/delchannel",{params:{id:l}})},{onSuccess:function(){X.p.invalidateQueries("channelList")},onError:function(i){var d;m.ZP.error((d=i==null?void 0:i.data)!==null&&d!==void 0?d:"Unknown error")}}),be=(0,g.useMutation)(function(l){return p.h.post("/updatechannel",se(l),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){X.p.invalidateQueries("channelList")},onError:function(i){var d;m.ZP.error((d=i==null?void 0:i.data)!==null&&d!==void 0?d:"Unknown error")}}),oe=(0,g.useQuery)("channelList",function(){return p.h.get("/channels",{responseType:"json"}).then(function(l){var i=JSON.parse(l.data);return Array.isArray(i)&&i.length&&(i.forEach(function(d,Ae){d.Parser=d.Parser||"youtube",d.No=Ae}),V(i.shift().M3U8)),i!=null?i:[]})},{refetchInterval:15e3,refetchOnWindowFocus:!0}),re=oe.data,Oe=oe.isLoading;function Ee(){E("add"),s(!0)}function Te(l){return s(!1),F==="add"?x.mutateAsync(l):be.mutateAsync(l)}function Ue(){navigator.clipboard.writeText(B).then(function(){K(!0),setTimeout(function(){K(!1)},3e3)}).catch(function(l){console.error("Failed to copy text:",l)})}var ie=(0,o.useCallback)(function(l){r(l),E("edit"),s(!0)},[]),ue=(0,o.useCallback)(function(l){k.Z.confirm({title:"Delete channel",content:'Do you want to delete the channel "'+l.Name+'" permanently?',okText:"Delete",cancelText:"Cancel",okType:"danger",onOk:function(){ae.mutate(l.ID)}})},[]),we=(0,o.useMemo)(function(){return te[te.length-1].render=function(l,i){return(0,e.jsxs)(S.Z,{children:[(0,e.jsx)(ee.Z,{onClick:function(){return ie(i)}}),(0,e.jsx)(de.Z,{onClick:function(){return ue(i)}})]})},te},[ie,ue]);return(0,e.jsxs)("div",{className:y.container,children:[(0,e.jsx)("h1",{className:y.title,children:(0,e.jsxs)(S.Z,{children:["LiveTV! ",(0,e.jsx)("small",{children:"IPTV feeds on your hand"}),(0,e.jsx)(ce.Z,{style:{fontSize:"16px"},onClick:function(){return I(!0)}})]})}),(0,e.jsxs)("div",{className:y.toolbar,children:[(0,e.jsxs)("div",{className:ve()([y.playlist,"flex"]),children:[(0,e.jsx)("span",{children:"Playlist:\xA0\xA0"}),(0,e.jsxs)(S.Z.Compact,{style:{flex:"1 1 99%"},children:[(0,e.jsx)(t.Z,{value:B,readOnly:!0}),(0,e.jsx)(b.Z,{title:$?"Copied":"Click to copy",children:(0,e.jsx)(U.ZP,{icon:(0,e.jsx)(he.Z,{}),onClick:Ue})})]})]}),(0,e.jsx)("div",{children:(0,e.jsx)(U.ZP,{type:"primary",onClick:Ee,style:{marginLeft:"5px"},children:"New channel"})})]}),(0,e.jsx)(j.Z,{size:"middle",locale:{emptyText:(0,e.jsx)("div",{style:{textAlign:"center"},children:"No channels yet"})},scroll:{x:"100%"},rowKey:"ID",dataSource:re!=null?re:[],loading:Oe,columns:we,pagination:{defaultPageSize:20,pageSizeOptions:[10,20,50,100],showSizeChanger:!0}}),(0,e.jsx)(je,{mode:F,visible:f,channel:h,onAdd:Te,onCancel:function(){return s(!1)}}),(0,e.jsx)(Ze,{visible:R,onClose:function(){return I(!1)}})]})}}}]);
