"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[482],{2999:function(de,z,n){n.d(z,{p:function(){return l},v:function(){return Z}});var W=n(88767),h=n(85893),l=new W.QueryClient({defaultOptions:{queries:{staleTime:30*1e3,refetchInterval:!1,refetchIntervalInBackground:!1,refetchOnWindowFocus:!1}}}),Z=function(A){var g=A.children;return(0,h.jsx)(W.QueryClientProvider,{client:l,children:g})}},82250:function(de,z,n){n.d(z,{h:function(){return g}});var W=n(5574),h=n.n(W),l=n(64599),Z=n.n(l),U=n(30937),A=n(82188),g=new U.YD({timeout:1e4,baseURL:"/api",withCredentials:!0});g.interceptors.request.use(function(a){if(a.headers["Content-Type"]==="multipart/form-data"){var f=new FormData;for(var p in a.data)a.data[p]!==void 0&&a.data[p]!==null&&f.append(p,a.data[p]);a.data=f}if(a.headers["Content-Type"]==="application/x-www-form-urlencoded"){var b=new URLSearchParams;for(var O in a.data)a.data[O]!==void 0&&a.data[O]!==null&&b.set(O,a.data[O]);a.data=b}return a},function(a){console.log(a),Promise.reject(a)}),g.interceptors.response.use(function(a){switch(a.status){case 200:break;case 401:A.m8.replace("/login");default:return Promise.reject(a)}return a},function(a){return a.response?console.error("API Error:",a.response.data):a.request?console.error("Network Error:",a.request):console.error("Error:",a.message),Promise.reject(a)});function _(a){if(!a)return[];var f=a.split(";"),p=[],b=_createForOfIteratorHelper(f),O;try{for(b.s();!(O=b.n()).done;){var te=O.value,q=te.trim().split("="),ee=_slicedToArray(q,2),ae=ee[0],le=ee[1];p.push({key:ae,value:le})}}catch(re){b.e(re)}finally{b.f()}return p}},120:function(de,z,n){n.r(z),n.d(z,{default:function(){return De}});var W=n(5574),h=n.n(W),l=n(67294),Z={container:"container___bXV7B",title:"title___TH1Ur",liveUrl:"liveUrl___E7uD9",m3u8:"m3u8____5PD_",playlist:"playlist___S8c1D",toolbar:"toolbar___JnoNk"},U=n(78957),A=n(5529),g=n(68872),_=n(72003),a=n(66184),f=n(56128),p=n(14726),b=n(72035),O=n(82911),te=n(89739),q=n(10844),ee=n(4340),ae=n(63606),le=n(2099),re=n(60532),xe=n(99611),ye=n(86548),Ce=n(48689),je=n(42952),ge=n(57132),pe=n(93967),Pe=n.n(pe),Se=n(97857),ne=n.n(Se),P=n(82250),u=n(27494),Ze=n(49288),be=n(84567),S=n(88767),ce={NewChannelDialog:"NewChannelDialog___A87pQ",TsProxySelector:"TsProxySelector___q636z"},X=n(2999),e=n(85893);function Oe(t){var j=u.Z.useForm(),C=h()(j,1),s=C[0],F=(0,l.useState)(!1),M=h()(F,2),$=M[0],L=M[1],k=(0,l.useState)(!1),I=h()(k,2),N=I[0],T=I[1],R=a.default.Option,D=(0,l.useRef)(null),J=(0,l.useState)(""),H=h()(J,2),Q=H[0],w=H[1],Y=(0,l.useState)(""),V=h()(Y,2),E=V[0],B=V[1],K=(0,S.useQuery)("parsers",function(){return P.h.get("/plugins").then(function(c){return JSON.parse(c.data).map(function(i){return{label:i,value:i}})})}),d=K.data,G=(0,S.useQuery)("category",function(){return P.h.get("/category").then(function(c){var i;return((i=JSON.parse(c.data))!==null&&i!==void 0?i:[]).map(function(y){return{value:y}})})}),x=G.data,oe=(0,l.useMemo)(function(){var c,i=E.trim();return i?(c=x==null?void 0:x.filter(function(y){return y.value.includes(i)}))!==null&&c!==void 0?c:[]:x},[x,E]),m=(0,l.useMemo)(function(){return t.mode==="view"},[t.mode]);function ie(){s==null||s.validateFields().then(function(c){L(!0),t.onAdd(ne()(ne()({},c),{},{Proxy:c.Proxy&&c.Proxy!=="0",TsProxy:c.Proxy==="2"?Q:"",ProxyUrl:c.UseProxy?c.ProxyUrl:""})).then(function(){E&&!(x!=null&&x.find(function(i){return i.value===E}))&&X.p.invalidateQueries("category")}).finally(function(){L(!1)})})}(0,l.useEffect)(function(){t.visible&&(T(!1),B(""),s==null||s.resetFields(),s==null||s.setFieldValue("Parser","http"),(t.mode==="edit"||t.mode==="view")&&(s==null||s.setFieldsValue(ne()(ne()({},t.channel),{},{Proxy:t.channel.Proxy?t.channel.TsProxy?"2":"1":"0",UseProxy:!!t.channel.ProxyUrl})),T(!!t.channel.ProxyUrl),w(t.channel.TsProxy)))},[t.visible]);function ue(c,i){var y=i.UseProxy;T(!!y)}return(0,e.jsx)(_.Z,{open:t.visible,onCancel:t.onCancel,onOk:m?t.onCancel:ie,cancelButtonProps:{style:{visibility:m?"hidden":"visible"}},destroyOnClose:!0,maskClosable:m,confirmLoading:$,className:ce.NewChannelDialog,title:t.mode==="add"?"New Channel":m?"View Channel":"Edit Channel",children:(0,e.jsx)("div",{style:{marginTop:20},children:(0,e.jsx)(u.Z,{labelCol:{span:6},form:s,onValuesChange:ue,initialValues:{Proxy:"0"},children:(0,e.jsxs)("fieldset",{disabled:m,children:[(0,e.jsx)(u.Z.Item,{name:"ID",hidden:!0}),(0,e.jsx)(u.Z.Item,{label:"Channel Name",name:"Name",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"Channel name",allowClear:!0,readOnly:m})}),(0,e.jsx)(u.Z.Item,{label:"Live URL",name:"URL",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"URL",allowClear:!0,readOnly:m})}),(0,e.jsx)(u.Z.Item,{label:"Parser",name:"Parser",rules:[{required:!0}],children:(0,e.jsx)(a.default,{placeholder:"URL",options:d,disabled:m})}),(0,e.jsx)(u.Z.Item,{label:"Category",name:"Category",children:(0,e.jsx)(Ze.Z,{placeholder:"Select or type new category names",options:oe,onSearch:B,disabled:m})}),(0,e.jsx)(u.Z.Item,{label:"Proxy stream",name:"Proxy",children:(0,e.jsxs)(a.default,{optionLabelProp:"title",disabled:m,children:[(0,e.jsx)(R,{value:"0",title:"No proxy",children:"No proxy"}),(0,e.jsx)(R,{value:"1",title:"Same as baseurl",children:"Same as baseurl"}),(0,e.jsx)(R,{value:"2",title:"Custom: "+Q,children:(0,e.jsxs)("div",{className:ce.TsProxySelector,children:[(0,e.jsx)("span",{children:"Custom:"}),(0,e.jsx)(f.Z,{ref:D,onClick:function(i){var y;i.stopPropagation(),(y=D.current)===null||y===void 0||y.focus()},onDoubleClick:function(){var i;(i=D.current)===null||i===void 0||i.select()},placeholder:"https://example.com",value:Q,onChange:function(i){return w(i.target.value)}})]})})]})}),(0,e.jsx)(u.Z.Item,{label:"Use Proxy",name:"UseProxy",valuePropName:"checked",children:(0,e.jsx)(be.Z,{})}),(0,e.jsx)(u.Z.Item,{label:"Proxy string",name:"ProxyUrl",hidden:!N,children:(0,e.jsx)(f.Z,{placeholder:"socks5://user:password@example.com:443",readOnly:m})})]})})})})}var Te=n(75214),we=n(82188),Ee=n(73711),Ue=n(64576);function Ae(t){var j=u.Z.useForm(),C=h()(j,1),s=C[0],F=u.Z.useForm(),M=h()(F,1),$=M[0],L=(0,l.useState)("config"),k=h()(L,2),I=k[0],N=k[1];function T(){s.setFieldValue("baseurl",window.location.origin)}function R(){var d=Math.random().toString(36).substring(2);s.setFieldValue("secret",d)}var D=function(){return(0,e.jsxs)(u.Z,{labelCol:{span:6},form:s,children:[(0,e.jsx)(u.Z.Item,{name:"cmd",label:"yt-dlp Cmd",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"yt-dlp"})}),(0,e.jsx)(u.Z.Item,{name:"args",label:"yt-dlp Args",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"--extractor-args youtube:skip=dash -f b -g {url}"})}),(0,e.jsx)(u.Z.Item,{name:"baseurl",label:"BaseUrl",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:window.location.origin,suffix:(0,e.jsx)(A.Z,{title:"Autofill with current site",children:(0,e.jsx)(Ee.Z,{onClick:T})})})}),(0,e.jsx)(u.Z.Item,{name:"secret",label:"Server secret",children:(0,e.jsx)(f.Z,{suffix:(0,e.jsx)(A.Z,{title:"Randomize",children:(0,e.jsx)(Ue.Z,{onClick:R})})})}),(0,e.jsx)(u.Z.Item,{name:"apikey",label:"Data API",children:(0,e.jsx)(f.Z,{})})]})},J=function(){return(0,e.jsxs)(u.Z,{labelCol:{span:7},form:$,children:[(0,e.jsx)(u.Z.Item,{name:"password",label:"New Password",rules:[{required:!0,message:"Input your password"}],children:(0,e.jsx)(f.Z,{type:"password"})}),(0,e.jsx)(u.Z.Item,{name:"password2",label:"Repeat Password",rules:[{required:!0,message:"Repeat your password"}],children:(0,e.jsx)(f.Z,{type:"password"})})]})},H=function(){return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{children:["Based on ",(0,e.jsx)("a",{href:"https://github.com/zjyl1994/livetv",children:"LiveTV!"})," by ",(0,e.jsx)("a",{href:"https://github.com/zjyl1994",children:"zjyl1994."})]}),(0,e.jsxs)("div",{children:["Forked by ",(0,e.jsx)("a",{href:"https://github.com/snowie2000",children:"snowie2000"})]}),(0,e.jsxs)("div",{children:["Made with ",(0,e.jsx)("span",{style:{color:"#e25555"},children:"\u2665"})," in Kwangtung."]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("a",{href:"/log",target:"_blank",children:"View log"}),"\xA0\xA0\xA0|\xA0\xA0\xA0",(0,e.jsx)("a",{onClick:function(){return E.mutate()},children:"Log out"})]})]})},Q=(0,S.useQuery)("live-config",function(){return P.h.get("/getconfig").then(function(d){return JSON.parse(d.data)})},{enabled:t.visible}),w=Q.data;(0,l.useEffect)(function(){t.visible&&w&&s.setFieldsValue(w)},[w,t.visible]),(0,l.useEffect)(function(){t.visible&&N("config")},[t.visible]);var Y=(0,S.useMutation)(function(d){return P.h.post("/updconfig",d,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){X.p.invalidateQueries("live-config")}}),V=(0,S.useMutation)(function(d){return P.h.post("/changepwd",d,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}),E=(0,S.useMutation)(function(){return P.h.get("/logout")},{onSuccess:function(){function G(x){document.cookie="".concat(x,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/")}G("mysession"),we.m8.replace("/login")}});function B(){switch(I){case"config":{s.validateFields().then(Y.mutateAsync).then(function(){return t.onClose()});break}case"password":{$.validateFields().then(function(d){return d.password!==d.password2?(g.ZP.warning("Passwords do not match"),Promise.reject()):V.mutateAsync(d)}).then(function(){E.mutate(),t.onClose()});break}case"about":{t.onClose();break}}}var K=[{label:"Config",key:"config",children:(0,e.jsx)(D,{})},{label:"Password",key:"password",children:(0,e.jsx)(J,{})},{label:"About",key:"about",children:(0,e.jsx)(H,{})}];return(0,e.jsx)(_.Z,{title:"Options",open:t.visible,onCancel:t.onClose,onOk:B,destroyOnClose:!0,children:(0,e.jsx)(Te.Z,{items:K,defaultActiveKey:"config",activeKey:I,onChange:N})})}var se=[{title:"#",width:60,dataIndex:"No"},{title:"Name",width:150,dataIndex:"Name"},{title:"Live",dataIndex:"URL",render:function(j){return(0,e.jsx)("span",{className:Z.liveUrl,children:j})}},{title:"M3U8",dataIndex:"M3U8",render:function(j,C,s){var F=[(0,e.jsx)(O.Z,{style:{color:"#CCC"}}),(0,e.jsx)(te.Z,{style:{color:"#52c41a"}}),(0,e.jsx)(q.Z,{style:{color:"#faad14"}}),(0,e.jsx)(ee.Z,{style:{color:"#ff4d4f"}}),(0,e.jsx)(q.Z,{style:{color:"#faad14"}})];return(0,e.jsxs)(U.Z,{children:[(0,e.jsx)(A.Z,{title:(0,e.jsxs)(e.Fragment,{children:[C.Message,(0,e.jsx)("br",{}),C.LastUpdate]}),children:F[C.Status]}),(0,e.jsx)("span",{className:Z.m3u8,children:j})]})}},{title:"Proxy",width:80,render:function(j,C){return(0,e.jsxs)(U.Z,{children:[C.Proxy&&(0,e.jsx)(ae.Z,{title:"Stream proxied"}),!!C.ProxyUrl&&(0,e.jsx)(le.Z,{title:"Connect via proxy"})]})}},{title:(0,e.jsx)(re.Z,{}),width:80}],Ie=[{label:"M3U",value:"lives.m3u"},{label:"TXT",value:"lives.txt"}];function he(t){return{id:t.ID,url:t.URL,name:t.Name,proxy:t.Proxy,parser:t.Parser,proxyurl:t.ProxyUrl,tsproxy:t.TsProxy,category:t.Category}}function De(){var t=(0,l.useState)(!1),j=h()(t,2),C=j[0],s=j[1],F=(0,l.useState)(!1),M=h()(F,2),$=M[0],L=M[1],k=(0,l.useState)("add"),I=h()(k,2),N=I[0],T=I[1],R=(0,l.useState)(""),D=h()(R,2),J=D[0],H=D[1],Q=(0,l.useState)(!1),w=h()(Q,2),Y=w[0],V=w[1],E=(0,l.useState)("lives.m3u"),B=h()(E,2),K=B[0],d=B[1],G=(0,l.useState)(),x=h()(G,2),oe=x[0],m=x[1];(0,l.useEffect)(function(){document.title="Channel List - LiveTV!"},[]);var ie=(0,S.useMutation)(function(r){return P.h.post("/newchannel",he(r),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){X.p.invalidateQueries("channelList")},onError:function(o){var v;g.ZP.error((v=o==null?void 0:o.data)!==null&&v!==void 0?v:"Unknown error")}}),ue=(0,S.useMutation)(function(r){return P.h.get("/delchannel",{params:{id:r}})},{onSuccess:function(){X.p.invalidateQueries("channelList")},onError:function(o){var v;g.ZP.error((v=o==null?void 0:o.data)!==null&&v!==void 0?v:"Unknown error")}}),c=(0,S.useMutation)(function(r){return P.h.post("/updatechannel",he(r),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){X.p.invalidateQueries("channelList")},onError:function(o){var v;g.ZP.error((v=o==null?void 0:o.data)!==null&&v!==void 0?v:"Unknown error")}}),i=(0,S.useQuery)("channelList",function(){return P.h.get("/channels",{responseType:"json"}).then(function(r){var o=JSON.parse(r.data);return Array.isArray(o)&&o.length&&(o.forEach(function(v,Ve){v.Parser=v.Parser||"http",v.No=Ve}),H(o.shift().M3U8)),o!=null?o:[]})},{refetchInterval:15e3,refetchOnWindowFocus:!0}),y=i.data,Fe=i.isLoading,ve=(0,l.useMemo)(function(){return J.replace("lives.m3u",K)},[K,J]);function Me(){T("add"),s(!0)}function Le(r){return s(!1),N==="add"?ie.mutateAsync(r):c.mutateAsync(r)}function Ne(){navigator.clipboard.writeText(ve).then(function(){V(!0),setTimeout(function(){V(!1)},3e3)}).catch(function(r){console.error("Failed to copy text:",r)})}var fe=(0,l.useCallback)(function(r){m(r),T("edit"),s(!0)},[]),Re=(0,l.useCallback)(function(r){m(r),T("view"),s(!0)},[]),me=(0,l.useCallback)(function(r){_.Z.confirm({title:"Delete channel",content:'Do you want to delete the channel "'+r.Name+'" permanently?',okText:"Delete",cancelText:"Cancel",okType:"danger",onOk:function(){ue.mutate(r.ID)}})},[]),Qe=(0,l.useMemo)(function(){return se[se.length-1].render=function(r,o){return o.Virtual?(0,e.jsx)(xe.Z,{onClick:function(){return Re(o)}}):(0,e.jsxs)(U.Z,{children:[(0,e.jsx)(ye.Z,{onClick:function(){return fe(o)}}),(0,e.jsx)(Ce.Z,{onClick:function(){return me(o)}})]})},se},[fe,me]);return(0,e.jsxs)("div",{className:Z.container,children:[(0,e.jsx)("h1",{className:Z.title,children:(0,e.jsxs)(U.Z,{children:["LiveTV! ",(0,e.jsx)("small",{children:"IPTV feeds on your hand"}),(0,e.jsx)(je.Z,{style:{fontSize:"16px"},onClick:function(){return L(!0)}})]})}),(0,e.jsxs)("div",{className:Z.toolbar,children:[(0,e.jsxs)("div",{className:Pe()([Z.playlist,"flex"]),children:[(0,e.jsx)("span",{children:"Playlist:\xA0\xA0"}),(0,e.jsxs)(U.Z.Compact,{style:{flex:"1 1 99%"},children:[(0,e.jsx)(a.default,{defaultValue:"lives.m3u",value:K,onChange:d,options:Ie}),(0,e.jsx)(f.Z,{value:ve,readOnly:!0}),(0,e.jsx)(A.Z,{title:Y?"Copied":"Click to copy",children:(0,e.jsx)(p.ZP,{icon:(0,e.jsx)(ge.Z,{}),onClick:Ne})})]})]}),(0,e.jsx)("div",{children:(0,e.jsx)(p.ZP,{type:"primary",onClick:Me,style:{marginLeft:"5px"},children:"New channel"})})]}),(0,e.jsx)(b.Z,{size:"middle",locale:{emptyText:(0,e.jsx)("div",{style:{textAlign:"center"},children:"No channels yet"})},scroll:{x:"100%"},rowKey:"ID",dataSource:y!=null?y:[],loading:Fe,columns:Qe,pagination:{defaultPageSize:20,pageSizeOptions:[10,20,50,100],showSizeChanger:!0}}),(0,e.jsx)(Oe,{mode:N,visible:C,channel:oe,onAdd:Le,onCancel:function(){return s(!1)}}),(0,e.jsx)(Ae,{visible:$,onClose:function(){return L(!1)}})]})}}}]);
