"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[482],{2999:function(de,B,n){n.d(B,{p:function(){return l},v:function(){return g}});var K=n(88767),h=n(85893),l=new K.QueryClient({defaultOptions:{queries:{staleTime:30*1e3,refetchInterval:!1,refetchIntervalInBackground:!1,refetchOnWindowFocus:!1}}}),g=function(T){var y=T.children;return(0,h.jsx)(K.QueryClientProvider,{client:l,children:y})}},82250:function(de,B,n){n.d(B,{h:function(){return y}});var K=n(5574),h=n.n(K),l=n(64599),g=n.n(l),E=n(30937),T=n(82188),y=new E.YD({timeout:1e4,baseURL:"/api",withCredentials:!0});y.interceptors.request.use(function(t){if(t.headers["Content-Type"]==="multipart/form-data"){var A=new FormData;for(var p in t.data)t.data[p]!==void 0&&t.data[p]!==null&&A.append(p,t.data[p]);t.data=A}if(t.headers["Content-Type"]==="application/x-www-form-urlencoded"){var P=new URLSearchParams;for(var S in t.data)t.data[S]!==void 0&&t.data[S]!==null&&P.set(S,t.data[S]);t.data=P}return t},function(t){console.log(t),Promise.reject(t)}),y.interceptors.response.use(function(t){switch(t.status){case 200:break;case 401:T.m8.replace("/login");default:return Promise.reject(t)}return t},function(t){return t.response?console.error("API Error:",t.response.data):t.request?console.error("Network Error:",t.request):console.error("Error:",t.message),Promise.reject(t)});function _(t){if(!t)return[];var A=t.split(";"),p=[],P=_createForOfIteratorHelper(A),S;try{for(P.s();!(S=P.n()).done;){var q=S.value,ae=q.trim().split("="),ee=_slicedToArray(ae,2),re=ee[0],le=ee[1];p.push({key:re,value:le})}}catch(oe){P.e(oe)}finally{P.f()}return p}},120:function(de,B,n){n.r(B),n.d(B,{default:function(){return Ue}});var K=n(5574),h=n.n(K),l=n(67294),g={container:"container___bXV7B",title:"title___TH1Ur",liveUrl:"liveUrl___E7uD9",m3u8:"m3u8____5PD_",playlist:"playlist___S8c1D",toolbar:"toolbar___JnoNk"},E=n(78957),T=n(5529),y=n(68872),_=n(72003),t=n(71114),A=n(14726),p=n(72035),P=n(82911),S=n(89739),q=n(10844),ae=n(4340),ee=n(63606),re=n(2099),le=n(60532),oe=n(86548),ve=n(48689),me=n(42952),xe=n(57132),ye=n(93967),je=n.n(ye),Ce=n(97857),ne=n.n(Ce),j=n(82250),i=n(27494),se=n(66184),ge=n(49288),pe=n(84567),C=n(88767),Pe={TsProxySelector:"TsProxySelector___q636z"},H=n(2999),e=n(85893);function Se(a){var x=i.Z.useForm(),v=h()(x,1),o=v[0],F=(0,l.useState)(!1),D=h()(F,2),z=D[0],L=D[1],W=(0,l.useState)(!1),U=h()(W,2),M=U[0],I=U[1],N=se.default.Option,w=(0,l.useRef)(null),$=(0,l.useState)(""),k=h()($,2),R=k[0],Z=k[1],G=(0,l.useState)(""),Q=h()(G,2),b=Q[0],V=Q[1],X=(0,C.useQuery)("parsers",function(){return j.h.get("/plugins").then(function(c){return JSON.parse(c.data).map(function(u){return{label:u,value:u}})})}),d=X.data,J=(0,C.useQuery)("category",function(){return j.h.get("/category").then(function(c){return JSON.parse(c.data).map(function(u){return{value:u}})})}),m=J.data,ue=(0,l.useMemo)(function(){var c,u=b.trim();return u?(c=m==null?void 0:m.filter(function(O){return O.value.includes(u)}))!==null&&c!==void 0?c:[]:m},[m,b]);function te(){o==null||o.validateFields().then(function(c){L(!0),a.onAdd(ne()(ne()({},c),{},{Proxy:c.Proxy&&c.Proxy!=="0",TsProxy:c.Proxy==="2"?R:"",ProxyUrl:c.UseProxy?c.ProxyUrl:""})).then(function(){b&&!(m!=null&&m.find(function(u){return u.value===b}))&&H.p.invalidateQueries("category")}).finally(function(){L(!1)})})}(0,l.useEffect)(function(){a.visible&&(I(!1),V(""),o==null||o.resetFields(),o==null||o.setFieldValue("Parser","youtube"),a.mode==="edit"&&(o==null||o.setFieldsValue(ne()(ne()({},a.channel),{},{Proxy:a.channel.Proxy?a.channel.TsProxy?"2":"1":"0",UseProxy:!!a.channel.ProxyUrl})),I(!!a.channel.ProxyUrl),Z(a.channel.TsProxy)))},[a.visible]);function Y(c,u){var O=u.UseProxy;I(!!O)}return(0,e.jsx)(_.Z,{open:a.visible,onCancel:a.onCancel,onOk:te,destroyOnClose:!0,maskClosable:!1,confirmLoading:z,title:a.mode==="add"?"New Channel":"Edit Channel",children:(0,e.jsx)("div",{style:{marginTop:20},children:(0,e.jsxs)(i.Z,{labelCol:{span:6},form:o,onValuesChange:Y,children:[(0,e.jsx)(i.Z.Item,{name:"ID",hidden:!0}),(0,e.jsx)(i.Z.Item,{label:"Channel Name",name:"Name",rules:[{required:!0}],children:(0,e.jsx)(t.Z,{placeholder:"Channel name",allowClear:!0})}),(0,e.jsx)(i.Z.Item,{label:"Live URL",name:"URL",rules:[{required:!0}],children:(0,e.jsx)(t.Z,{placeholder:"URL",allowClear:!0})}),(0,e.jsx)(i.Z.Item,{label:"Parser",name:"Parser",rules:[{required:!0}],children:(0,e.jsx)(se.default,{placeholder:"URL",options:d})}),(0,e.jsx)(i.Z.Item,{label:"Category",name:"Category",children:(0,e.jsx)(ge.Z,{placeholder:"Select or type new category names",options:ue,onSearch:V})}),(0,e.jsx)(i.Z.Item,{label:"Proxy stream",name:"Proxy",children:(0,e.jsxs)(se.default,{optionLabelProp:"title",defaultValue:"0",children:[(0,e.jsx)(N,{value:"0",title:"No proxy",children:"No proxy"}),(0,e.jsx)(N,{value:"1",title:"Same as baseurl",children:"Same as baseurl"}),(0,e.jsx)(N,{value:"2",title:"Custom: "+R,children:(0,e.jsxs)("div",{className:Pe.TsProxySelector,children:[(0,e.jsx)("span",{children:"Custom:"}),(0,e.jsx)(t.Z,{ref:w,onClick:function(u){var O;u.stopPropagation(),(O=w.current)===null||O===void 0||O.focus()},onDoubleClick:function(){var u;(u=w.current)===null||u===void 0||u.select()},placeholder:"https://example.com",value:R,onChange:function(u){return Z(u.target.value)}})]})})]})}),(0,e.jsx)(i.Z.Item,{label:"Use Proxy",name:"UseProxy",valuePropName:"checked",children:(0,e.jsx)(pe.Z,{})}),(0,e.jsx)(i.Z.Item,{label:"Proxy string",name:"ProxyUrl",hidden:!M,children:(0,e.jsx)(t.Z,{placeholder:"socks5://user:password@example.com:443"})})]})})})}var Ze=n(75214),be=n(82188),Oe=n(73711),Ee=n(64576);function Te(a){var x=i.Z.useForm(),v=h()(x,1),o=v[0],F=i.Z.useForm(),D=h()(F,1),z=D[0],L=(0,l.useState)("config"),W=h()(L,2),U=W[0],M=W[1];function I(){o.setFieldValue("baseurl",window.location.origin)}function N(){var d=Math.random().toString(36).substring(2);o.setFieldValue("secret",d)}var w=function(){return(0,e.jsxs)(i.Z,{labelCol:{span:6},form:o,children:[(0,e.jsx)(i.Z.Item,{name:"cmd",label:"yt-dlp Cmd",rules:[{required:!0}],children:(0,e.jsx)(t.Z,{placeholder:"yt-dlp"})}),(0,e.jsx)(i.Z.Item,{name:"args",label:"yt-dlp Args",rules:[{required:!0}],children:(0,e.jsx)(t.Z,{placeholder:"--extractor-args youtube:skip=dash -f b -g {url}"})}),(0,e.jsx)(i.Z.Item,{name:"baseurl",label:"BaseUrl",rules:[{required:!0}],children:(0,e.jsx)(t.Z,{placeholder:window.location.origin,suffix:(0,e.jsx)(T.Z,{title:"Autofill with current site",children:(0,e.jsx)(Oe.Z,{onClick:I})})})}),(0,e.jsx)(i.Z.Item,{name:"secret",label:"Server secret",children:(0,e.jsx)(t.Z,{suffix:(0,e.jsx)(T.Z,{title:"Randomize",children:(0,e.jsx)(Ee.Z,{onClick:N})})})}),(0,e.jsx)(i.Z.Item,{name:"apikey",label:"Data API",children:(0,e.jsx)(t.Z,{})})]})},$=function(){return(0,e.jsxs)(i.Z,{labelCol:{span:7},form:z,children:[(0,e.jsx)(i.Z.Item,{name:"password",label:"New Password",rules:[{required:!0,message:"Input your password"}],children:(0,e.jsx)(t.Z,{type:"password"})}),(0,e.jsx)(i.Z.Item,{name:"password2",label:"Repeat Password",rules:[{required:!0,message:"Repeat your password"}],children:(0,e.jsx)(t.Z,{type:"password"})})]})},k=function(){return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{children:["Based on ",(0,e.jsx)("a",{href:"https://github.com/snowie2000/livetv",children:"LiveTV!"})," by ",(0,e.jsx)("a",{href:"https://github.com/zjyl1994",children:"zjyl1994."})]}),(0,e.jsxs)("div",{children:["Forked by ",(0,e.jsx)("a",{href:"https://github.com/snowie2000",children:"snowie2000"})]}),(0,e.jsxs)("div",{children:["Made with ",(0,e.jsx)("span",{style:{color:"#e25555"},children:"\u2665"})," in Kwangtung."]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("a",{href:"/log",target:"_blank",children:"View log"}),"\xA0\xA0\xA0|\xA0\xA0\xA0",(0,e.jsx)("a",{onClick:function(){return b.mutate()},children:"Log out"})]})]})},R=(0,C.useQuery)("live-config",function(){return j.h.get("/getconfig").then(function(d){return JSON.parse(d.data)})},{enabled:a.visible}),Z=R.data;(0,l.useEffect)(function(){a.visible&&Z&&o.setFieldsValue(Z)},[Z,a.visible]),(0,l.useEffect)(function(){a.visible&&M("config")},[a.visible]);var G=(0,C.useMutation)(function(d){return j.h.post("/updconfig",d,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){H.p.invalidateQueries("live-config")}}),Q=(0,C.useMutation)(function(d){return j.h.post("/changepwd",d,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}),b=(0,C.useMutation)(function(){return j.h.get("/logout")},{onSuccess:function(){function J(m){document.cookie="".concat(m,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/")}J("mysession"),be.m8.replace("/login")}});function V(){switch(U){case"config":{o.validateFields().then(G.mutateAsync).then(function(){return a.onClose()});break}case"password":{z.validateFields().then(function(d){return d.password!==d.password2?(y.ZP.warning("Passwords do not match"),Promise.reject()):Q.mutateAsync(d)}).then(function(){b.mutate(),a.onClose()});break}case"about":{a.onClose();break}}}var X=[{label:"Config",key:"config",children:(0,e.jsx)(w,{})},{label:"Password",key:"password",children:(0,e.jsx)($,{})},{label:"About",key:"about",children:(0,e.jsx)(k,{})}];return(0,e.jsx)(_.Z,{title:"Options",open:a.visible,onCancel:a.onClose,onOk:V,destroyOnClose:!0,children:(0,e.jsx)(Ze.Z,{items:X,defaultActiveKey:"config",activeKey:U,onChange:M})})}var ie=[{title:"#",width:60,dataIndex:"No"},{title:"Name",width:150,dataIndex:"Name"},{title:"Live",dataIndex:"URL",render:function(x){return(0,e.jsx)("span",{className:g.liveUrl,children:x})}},{title:"M3U8",dataIndex:"M3U8",render:function(x,v,o){var F=[(0,e.jsx)(P.Z,{style:{color:"#CCC"}}),(0,e.jsx)(S.Z,{style:{color:"#52c41a"}}),(0,e.jsx)(q.Z,{style:{color:"#faad14"}}),(0,e.jsx)(ae.Z,{style:{color:"#ff4d4f"}}),(0,e.jsx)(q.Z,{style:{color:"#faad14"}})];return(0,e.jsxs)(E.Z,{children:[(0,e.jsx)(T.Z,{title:(0,e.jsxs)(e.Fragment,{children:[v.Message,(0,e.jsx)("br",{}),v.LastUpdate]}),children:F[v.Status]}),(0,e.jsx)("span",{className:g.m3u8,children:x})]})}},{title:"Proxy",width:80,render:function(x,v){return(0,e.jsxs)(E.Z,{children:[v.Proxy&&(0,e.jsx)(ee.Z,{title:"Stream proxied"}),!!v.ProxyUrl&&(0,e.jsx)(re.Z,{title:"Connect via proxy"})]})}},{title:(0,e.jsx)(le.Z,{}),width:80}];function ce(a){return{id:a.ID,url:a.URL,name:a.Name,proxy:a.Proxy,parser:a.Parser,proxyurl:a.ProxyUrl,tsproxy:a.TsProxy,category:a.Category}}function Ue(){var a=(0,l.useState)(!1),x=h()(a,2),v=x[0],o=x[1],F=(0,l.useState)(!1),D=h()(F,2),z=D[0],L=D[1],W=(0,l.useState)("add"),U=h()(W,2),M=U[0],I=U[1],N=(0,l.useState)(""),w=h()(N,2),$=w[0],k=w[1],R=(0,l.useState)(!1),Z=h()(R,2),G=Z[0],Q=Z[1],b=(0,l.useState)(),V=h()(b,2),X=V[0],d=V[1];(0,l.useEffect)(function(){document.title="Channel List - LiveTV!"},[]);var J=(0,C.useMutation)(function(r){return j.h.post("/newchannel",ce(r),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){H.p.invalidateQueries("channelList")},onError:function(s){var f;y.ZP.error((f=s==null?void 0:s.data)!==null&&f!==void 0?f:"Unknown error")}}),m=(0,C.useMutation)(function(r){return j.h.get("/delchannel",{params:{id:r}})},{onSuccess:function(){H.p.invalidateQueries("channelList")},onError:function(s){var f;y.ZP.error((f=s==null?void 0:s.data)!==null&&f!==void 0?f:"Unknown error")}}),ue=(0,C.useMutation)(function(r){return j.h.post("/updatechannel",ce(r),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){H.p.invalidateQueries("channelList")},onError:function(s){var f;y.ZP.error((f=s==null?void 0:s.data)!==null&&f!==void 0?f:"Unknown error")}}),te=(0,C.useQuery)("channelList",function(){return j.h.get("/channels",{responseType:"json"}).then(function(r){var s=JSON.parse(r.data);return Array.isArray(s)&&s.length&&(s.forEach(function(f,Ae){f.Parser=f.Parser||"youtube",f.No=Ae}),k(s.shift().M3U8)),s!=null?s:[]})},{refetchInterval:15e3,refetchOnWindowFocus:!0}),Y=te.data,c=te.isLoading;function u(){I("add"),o(!0)}function O(r){return o(!1),M==="add"?J.mutateAsync(r):ue.mutateAsync(r)}function Ie(){navigator.clipboard.writeText($).then(function(){Q(!0),setTimeout(function(){Q(!1)},3e3)}).catch(function(r){console.error("Failed to copy text:",r)})}var he=(0,l.useCallback)(function(r){d(r),I("edit"),o(!0)},[]),fe=(0,l.useCallback)(function(r){_.Z.confirm({title:"Delete channel",content:'Do you want to delete the channel "'+r.Name+'" permanently?',okText:"Delete",cancelText:"Cancel",okType:"danger",onOk:function(){m.mutate(r.ID)}})},[]),we=(0,l.useMemo)(function(){return ie[ie.length-1].render=function(r,s){return(0,e.jsxs)(E.Z,{children:[(0,e.jsx)(oe.Z,{onClick:function(){return he(s)}}),(0,e.jsx)(ve.Z,{onClick:function(){return fe(s)}})]})},ie},[he,fe]);return(0,e.jsxs)("div",{className:g.container,children:[(0,e.jsx)("h1",{className:g.title,children:(0,e.jsxs)(E.Z,{children:["LiveTV! ",(0,e.jsx)("small",{children:"IPTV feeds on your hand"}),(0,e.jsx)(me.Z,{style:{fontSize:"16px"},onClick:function(){return L(!0)}})]})}),(0,e.jsxs)("div",{className:g.toolbar,children:[(0,e.jsxs)("div",{className:je()([g.playlist,"flex"]),children:[(0,e.jsx)("span",{children:"Playlist:\xA0\xA0"}),(0,e.jsxs)(E.Z.Compact,{style:{flex:"1 1 99%"},children:[(0,e.jsx)(t.Z,{value:$,readOnly:!0}),(0,e.jsx)(T.Z,{title:G?"Copied":"Click to copy",children:(0,e.jsx)(A.ZP,{icon:(0,e.jsx)(xe.Z,{}),onClick:Ie})})]})]}),(0,e.jsx)("div",{children:(0,e.jsx)(A.ZP,{type:"primary",onClick:u,style:{marginLeft:"5px"},children:"New channel"})})]}),(0,e.jsx)(p.Z,{size:"middle",locale:{emptyText:(0,e.jsx)("div",{style:{textAlign:"center"},children:"No channels yet"})},scroll:{x:"100%"},rowKey:"ID",dataSource:Y!=null?Y:[],loading:c,columns:we,pagination:{defaultPageSize:20,pageSizeOptions:[10,20,50,100],showSizeChanger:!0}}),(0,e.jsx)(Se,{mode:M,visible:v,channel:X,onAdd:O,onCancel:function(){return o(!1)}}),(0,e.jsx)(Te,{visible:z,onClose:function(){return L(!1)}})]})}}}]);
