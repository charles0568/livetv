"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[482],{2999:function(de,K,t){t.d(K,{p:function(){return r},v:function(){return S}});var z=t(88767),h=t(85893),r=new z.QueryClient({defaultOptions:{queries:{staleTime:30*1e3,refetchInterval:!1,refetchIntervalInBackground:!1,refetchOnWindowFocus:!1}}}),S=function(E){var j=E.children;return(0,h.jsx)(z.QueryClientProvider,{client:r,children:j})}},82250:function(de,K,t){t.d(K,{h:function(){return j}});var z=t(5574),h=t.n(z),r=t(64599),S=t.n(r),U=t(30937),E=t(82188),j=new U.YD({timeout:1e4,baseURL:"/api",withCredentials:!0});j.interceptors.request.use(function(a){if(a.headers["Content-Type"]==="multipart/form-data"){var f=new FormData;for(var C in a.data)a.data[C]!==void 0&&a.data[C]!==null&&f.append(C,a.data[C]);a.data=f}if(a.headers["Content-Type"]==="application/x-www-form-urlencoded"){var Z=new URLSearchParams;for(var b in a.data)a.data[b]!==void 0&&a.data[b]!==null&&Z.set(b,a.data[b]);a.data=Z}return a},function(a){console.log(a),Promise.reject(a)}),j.interceptors.response.use(function(a){switch(a.status){case 200:break;case 401:E.m8.replace("/login");default:return Promise.reject(a)}return a},function(a){return a.response?console.error("API Error:",a.response.data):a.request?console.error("Network Error:",a.request):console.error("Error:",a.message),Promise.reject(a)});function Y(a){if(!a)return[];var f=a.split(";"),C=[],Z=_createForOfIteratorHelper(f),b;try{for(Z.s();!(b=Z.n()).done;){var te=b.value,_=te.trim().split("="),q=_slicedToArray(_,2),ne=q[0],ae=q[1];C.push({key:ne,value:ae})}}catch(re){Z.e(re)}finally{Z.f()}return C}},120:function(de,K,t){t.r(K),t.d(K,{default:function(){return Ae}});var z=t(5574),h=t.n(z),r=t(67294),S={container:"container___bXV7B",title:"title___TH1Ur",liveUrl:"liveUrl___E7uD9",m3u8:"m3u8____5PD_",playlist:"playlist___S8c1D",toolbar:"toolbar___JnoNk"},U=t(78957),E=t(5529),j=t(68872),Y=t(72003),a=t(66184),f=t(71114),C=t(14726),Z=t(72035),b=t(82911),te=t(89739),_=t(10844),q=t(4340),ne=t(63606),ae=t(2099),re=t(60532),me=t(86548),xe=t(48689),ye=t(42952),je=t(57132),Ce=t(93967),pe=t.n(Ce),ge=t(97857),ee=t.n(ge),p=t(82250),i=t(27494),Pe=t(49288),Se=t(84567),g=t(88767),Ze={TsProxySelector:"TsProxySelector___q636z"},G=t(2999),e=t(85893);function be(n){var y=i.Z.useForm(),x=h()(y,1),s=x[0],F=(0,r.useState)(!1),D=h()(F,2),W=D[0],M=D[1],$=(0,r.useState)(!1),I=h()($,2),L=I[0],w=I[1],N=a.default.Option,A=(0,r.useRef)(null),k=(0,r.useState)(""),J=h()(k,2),R=J[0],T=J[1],X=(0,r.useState)(""),Q=h()(X,2),O=Q[0],V=Q[1],B=(0,g.useQuery)("parsers",function(){return p.h.get("/plugins").then(function(c){return JSON.parse(c.data).map(function(u){return{label:u,value:u}})})}),d=B.data,H=(0,g.useQuery)("category",function(){return p.h.get("/category").then(function(c){return JSON.parse(c.data).map(function(u){return{value:u}})})}),m=H.data,se=(0,r.useMemo)(function(){var c,u=O.trim();return u?(c=m==null?void 0:m.filter(function(P){return P.value.includes(u)}))!==null&&c!==void 0?c:[]:m},[m,O]);function oe(){s==null||s.validateFields().then(function(c){M(!0),n.onAdd(ee()(ee()({},c),{},{Proxy:c.Proxy&&c.Proxy!=="0",TsProxy:c.Proxy==="2"?R:"",ProxyUrl:c.UseProxy?c.ProxyUrl:""})).then(function(){O&&!(m!=null&&m.find(function(u){return u.value===O}))&&G.p.invalidateQueries("category")}).finally(function(){M(!1)})})}(0,r.useEffect)(function(){n.visible&&(w(!1),V(""),s==null||s.resetFields(),s==null||s.setFieldValue("Parser","youtube"),n.mode==="edit"&&(s==null||s.setFieldsValue(ee()(ee()({},n.channel),{},{Proxy:n.channel.Proxy?n.channel.TsProxy?"2":"1":"0",UseProxy:!!n.channel.ProxyUrl})),w(!!n.channel.ProxyUrl),T(n.channel.TsProxy)))},[n.visible]);function ie(c,u){var P=u.UseProxy;w(!!P)}return(0,e.jsx)(Y.Z,{open:n.visible,onCancel:n.onCancel,onOk:oe,destroyOnClose:!0,maskClosable:!1,confirmLoading:W,title:n.mode==="add"?"New Channel":"Edit Channel",children:(0,e.jsx)("div",{style:{marginTop:20},children:(0,e.jsxs)(i.Z,{labelCol:{span:6},form:s,onValuesChange:ie,children:[(0,e.jsx)(i.Z.Item,{name:"ID",hidden:!0}),(0,e.jsx)(i.Z.Item,{label:"Channel Name",name:"Name",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"Channel name",allowClear:!0})}),(0,e.jsx)(i.Z.Item,{label:"Live URL",name:"URL",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"URL",allowClear:!0})}),(0,e.jsx)(i.Z.Item,{label:"Parser",name:"Parser",rules:[{required:!0}],children:(0,e.jsx)(a.default,{placeholder:"URL",options:d})}),(0,e.jsx)(i.Z.Item,{label:"Category",name:"Category",children:(0,e.jsx)(Pe.Z,{placeholder:"Select or type new category names",options:se,onSearch:V})}),(0,e.jsx)(i.Z.Item,{label:"Proxy stream",name:"Proxy",children:(0,e.jsxs)(a.default,{optionLabelProp:"title",defaultValue:"0",children:[(0,e.jsx)(N,{value:"0",title:"No proxy",children:"No proxy"}),(0,e.jsx)(N,{value:"1",title:"Same as baseurl",children:"Same as baseurl"}),(0,e.jsx)(N,{value:"2",title:"Custom: "+R,children:(0,e.jsxs)("div",{className:Ze.TsProxySelector,children:[(0,e.jsx)("span",{children:"Custom:"}),(0,e.jsx)(f.Z,{ref:A,onClick:function(u){var P;u.stopPropagation(),(P=A.current)===null||P===void 0||P.focus()},onDoubleClick:function(){var u;(u=A.current)===null||u===void 0||u.select()},placeholder:"https://example.com",value:R,onChange:function(u){return T(u.target.value)}})]})})]})}),(0,e.jsx)(i.Z.Item,{label:"Use Proxy",name:"UseProxy",valuePropName:"checked",children:(0,e.jsx)(Se.Z,{})}),(0,e.jsx)(i.Z.Item,{label:"Proxy string",name:"ProxyUrl",hidden:!L,children:(0,e.jsx)(f.Z,{placeholder:"socks5://user:password@example.com:443"})})]})})})}var Te=t(75214),Oe=t(82188),Ue=t(73711),Ee=t(64576);function Ie(n){var y=i.Z.useForm(),x=h()(y,1),s=x[0],F=i.Z.useForm(),D=h()(F,1),W=D[0],M=(0,r.useState)("config"),$=h()(M,2),I=$[0],L=$[1];function w(){s.setFieldValue("baseurl",window.location.origin)}function N(){var d=Math.random().toString(36).substring(2);s.setFieldValue("secret",d)}var A=function(){return(0,e.jsxs)(i.Z,{labelCol:{span:6},form:s,children:[(0,e.jsx)(i.Z.Item,{name:"cmd",label:"yt-dlp Cmd",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"yt-dlp"})}),(0,e.jsx)(i.Z.Item,{name:"args",label:"yt-dlp Args",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"--extractor-args youtube:skip=dash -f b -g {url}"})}),(0,e.jsx)(i.Z.Item,{name:"baseurl",label:"BaseUrl",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:window.location.origin,suffix:(0,e.jsx)(E.Z,{title:"Autofill with current site",children:(0,e.jsx)(Ue.Z,{onClick:w})})})}),(0,e.jsx)(i.Z.Item,{name:"secret",label:"Server secret",children:(0,e.jsx)(f.Z,{suffix:(0,e.jsx)(E.Z,{title:"Randomize",children:(0,e.jsx)(Ee.Z,{onClick:N})})})}),(0,e.jsx)(i.Z.Item,{name:"apikey",label:"Data API",children:(0,e.jsx)(f.Z,{})})]})},k=function(){return(0,e.jsxs)(i.Z,{labelCol:{span:7},form:W,children:[(0,e.jsx)(i.Z.Item,{name:"password",label:"New Password",rules:[{required:!0,message:"Input your password"}],children:(0,e.jsx)(f.Z,{type:"password"})}),(0,e.jsx)(i.Z.Item,{name:"password2",label:"Repeat Password",rules:[{required:!0,message:"Repeat your password"}],children:(0,e.jsx)(f.Z,{type:"password"})})]})},J=function(){return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{children:["Based on ",(0,e.jsx)("a",{href:"https://github.com/zjyl1994/livetv",children:"LiveTV!"})," by ",(0,e.jsx)("a",{href:"https://github.com/zjyl1994",children:"zjyl1994."})]}),(0,e.jsxs)("div",{children:["Forked by ",(0,e.jsx)("a",{href:"https://github.com/snowie2000",children:"snowie2000"})]}),(0,e.jsxs)("div",{children:["Made with ",(0,e.jsx)("span",{style:{color:"#e25555"},children:"\u2665"})," in Kwangtung."]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("a",{href:"/log",target:"_blank",children:"View log"}),"\xA0\xA0\xA0|\xA0\xA0\xA0",(0,e.jsx)("a",{onClick:function(){return O.mutate()},children:"Log out"})]})]})},R=(0,g.useQuery)("live-config",function(){return p.h.get("/getconfig").then(function(d){return JSON.parse(d.data)})},{enabled:n.visible}),T=R.data;(0,r.useEffect)(function(){n.visible&&T&&s.setFieldsValue(T)},[T,n.visible]),(0,r.useEffect)(function(){n.visible&&L("config")},[n.visible]);var X=(0,g.useMutation)(function(d){return p.h.post("/updconfig",d,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){G.p.invalidateQueries("live-config")}}),Q=(0,g.useMutation)(function(d){return p.h.post("/changepwd",d,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}),O=(0,g.useMutation)(function(){return p.h.get("/logout")},{onSuccess:function(){function H(m){document.cookie="".concat(m,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/")}H("mysession"),Oe.m8.replace("/login")}});function V(){switch(I){case"config":{s.validateFields().then(X.mutateAsync).then(function(){return n.onClose()});break}case"password":{W.validateFields().then(function(d){return d.password!==d.password2?(j.ZP.warning("Passwords do not match"),Promise.reject()):Q.mutateAsync(d)}).then(function(){O.mutate(),n.onClose()});break}case"about":{n.onClose();break}}}var B=[{label:"Config",key:"config",children:(0,e.jsx)(A,{})},{label:"Password",key:"password",children:(0,e.jsx)(k,{})},{label:"About",key:"about",children:(0,e.jsx)(J,{})}];return(0,e.jsx)(Y.Z,{title:"Options",open:n.visible,onCancel:n.onClose,onOk:V,destroyOnClose:!0,children:(0,e.jsx)(Te.Z,{items:B,defaultActiveKey:"config",activeKey:I,onChange:L})})}var le=[{title:"#",width:60,dataIndex:"No"},{title:"Name",width:150,dataIndex:"Name"},{title:"Live",dataIndex:"URL",render:function(y){return(0,e.jsx)("span",{className:S.liveUrl,children:y})}},{title:"M3U8",dataIndex:"M3U8",render:function(y,x,s){var F=[(0,e.jsx)(b.Z,{style:{color:"#CCC"}}),(0,e.jsx)(te.Z,{style:{color:"#52c41a"}}),(0,e.jsx)(_.Z,{style:{color:"#faad14"}}),(0,e.jsx)(q.Z,{style:{color:"#ff4d4f"}}),(0,e.jsx)(_.Z,{style:{color:"#faad14"}})];return(0,e.jsxs)(U.Z,{children:[(0,e.jsx)(E.Z,{title:(0,e.jsxs)(e.Fragment,{children:[x.Message,(0,e.jsx)("br",{}),x.LastUpdate]}),children:F[x.Status]}),(0,e.jsx)("span",{className:S.m3u8,children:y})]})}},{title:"Proxy",width:80,render:function(y,x){return(0,e.jsxs)(U.Z,{children:[x.Proxy&&(0,e.jsx)(ne.Z,{title:"Stream proxied"}),!!x.ProxyUrl&&(0,e.jsx)(ae.Z,{title:"Connect via proxy"})]})}},{title:(0,e.jsx)(re.Z,{}),width:80}],we=[{label:"M3U",value:"lives.m3u"},{label:"TXT",value:"lives.txt"}];function ce(n){return{id:n.ID,url:n.URL,name:n.Name,proxy:n.Proxy,parser:n.Parser,proxyurl:n.ProxyUrl,tsproxy:n.TsProxy,category:n.Category}}function Ae(){var n=(0,r.useState)(!1),y=h()(n,2),x=y[0],s=y[1],F=(0,r.useState)(!1),D=h()(F,2),W=D[0],M=D[1],$=(0,r.useState)("add"),I=h()($,2),L=I[0],w=I[1],N=(0,r.useState)(""),A=h()(N,2),k=A[0],J=A[1],R=(0,r.useState)(!1),T=h()(R,2),X=T[0],Q=T[1],O=(0,r.useState)("lives.m3u"),V=h()(O,2),B=V[0],d=V[1],H=(0,r.useState)(),m=h()(H,2),se=m[0],oe=m[1];(0,r.useEffect)(function(){document.title="Channel List - LiveTV!"},[]);var ie=(0,g.useMutation)(function(l){return p.h.post("/newchannel",ce(l),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){G.p.invalidateQueries("channelList")},onError:function(o){var v;j.ZP.error((v=o==null?void 0:o.data)!==null&&v!==void 0?v:"Unknown error")}}),c=(0,g.useMutation)(function(l){return p.h.get("/delchannel",{params:{id:l}})},{onSuccess:function(){G.p.invalidateQueries("channelList")},onError:function(o){var v;j.ZP.error((v=o==null?void 0:o.data)!==null&&v!==void 0?v:"Unknown error")}}),u=(0,g.useMutation)(function(l){return p.h.post("/updatechannel",ce(l),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){G.p.invalidateQueries("channelList")},onError:function(o){var v;j.ZP.error((v=o==null?void 0:o.data)!==null&&v!==void 0?v:"Unknown error")}}),P=(0,g.useQuery)("channelList",function(){return p.h.get("/channels",{responseType:"json"}).then(function(l){var o=JSON.parse(l.data);return Array.isArray(o)&&o.length&&(o.forEach(function(v,Re){v.Parser=v.Parser||"youtube",v.No=Re}),J(o.shift().M3U8)),o!=null?o:[]})},{refetchInterval:15e3,refetchOnWindowFocus:!0}),ue=P.data,Fe=P.isLoading,he=(0,r.useMemo)(function(){return k.replace("lives.m3u",B)},[B,k]);function De(){w("add"),s(!0)}function Me(l){return s(!1),L==="add"?ie.mutateAsync(l):u.mutateAsync(l)}function Le(){navigator.clipboard.writeText(he).then(function(){Q(!0),setTimeout(function(){Q(!1)},3e3)}).catch(function(l){console.error("Failed to copy text:",l)})}var fe=(0,r.useCallback)(function(l){oe(l),w("edit"),s(!0)},[]),ve=(0,r.useCallback)(function(l){Y.Z.confirm({title:"Delete channel",content:'Do you want to delete the channel "'+l.Name+'" permanently?',okText:"Delete",cancelText:"Cancel",okType:"danger",onOk:function(){c.mutate(l.ID)}})},[]),Ne=(0,r.useMemo)(function(){return le[le.length-1].render=function(l,o){return(0,e.jsxs)(U.Z,{children:[(0,e.jsx)(me.Z,{onClick:function(){return fe(o)}}),(0,e.jsx)(xe.Z,{onClick:function(){return ve(o)}})]})},le},[fe,ve]);return(0,e.jsxs)("div",{className:S.container,children:[(0,e.jsx)("h1",{className:S.title,children:(0,e.jsxs)(U.Z,{children:["LiveTV! ",(0,e.jsx)("small",{children:"IPTV feeds on your hand"}),(0,e.jsx)(ye.Z,{style:{fontSize:"16px"},onClick:function(){return M(!0)}})]})}),(0,e.jsxs)("div",{className:S.toolbar,children:[(0,e.jsxs)("div",{className:pe()([S.playlist,"flex"]),children:[(0,e.jsx)("span",{children:"Playlist:\xA0\xA0"}),(0,e.jsxs)(U.Z.Compact,{style:{flex:"1 1 99%"},children:[(0,e.jsx)(a.default,{defaultValue:"lives.m3u",value:B,onChange:d,options:we}),(0,e.jsx)(f.Z,{value:he,readOnly:!0}),(0,e.jsx)(E.Z,{title:X?"Copied":"Click to copy",children:(0,e.jsx)(C.ZP,{icon:(0,e.jsx)(je.Z,{}),onClick:Le})})]})]}),(0,e.jsx)("div",{children:(0,e.jsx)(C.ZP,{type:"primary",onClick:De,style:{marginLeft:"5px"},children:"New channel"})})]}),(0,e.jsx)(Z.Z,{size:"middle",locale:{emptyText:(0,e.jsx)("div",{style:{textAlign:"center"},children:"No channels yet"})},scroll:{x:"100%"},rowKey:"ID",dataSource:ue!=null?ue:[],loading:Fe,columns:Ne,pagination:{defaultPageSize:20,pageSizeOptions:[10,20,50,100],showSizeChanger:!0}}),(0,e.jsx)(be,{mode:L,visible:x,channel:se,onAdd:Me,onCancel:function(){return s(!1)}}),(0,e.jsx)(Ie,{visible:W,onClose:function(){return M(!1)}})]})}}}]);
